<iframe
    id="opinary-iframe"
    class="opinary-iframe"
    scrolling="no"
    marginheight="0"
    frameborder="0"
    no-mw-resize="true"
    allow="fullscreen"
    style="width:100%; height:100vh"
    src=""
    ></iframe>
<script type="text/javascript">
    function update_iframe_url() {
        let MEDIA_URL = 'https://valgrind.opinary.com/compasses/test_opinary_mcanvas_publisher/how-do-you-like-to-travel_productionengl?distributionCampaign=walmart_affinity_pg_0823';
        var urlparams = "&gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_STRING}";
        urlparams += "&amp=false&autsp=true&followUp=false&curl=${REFERER_URL_ENC}&embed=auto&paywall=anonymous&pub=affinityus&appIntegration=false&noLocalStorage=true";

        var VOTE_URL_ENC = '${CLICK_URL_ENC}';
        if (!VOTE_URL_ENC.startsWith('$')) {
            urlparams += "&voteTag=" + VOTE_URL_ENC;
        }
        
        var iframe = document.getElementById('opinary-iframe');
        iframe.src = MEDIA_URL + urlparams;
    }
</script>
<script type="text/javascript">
if (true) {
    let iframe = document.getElementById('opinary-iframe');
    iframe.style.width = 320;
    iframe.style.height = 320;
    iframe.addEventListener('load', function() {
        iframe.contentWindow.postMessage({
                type: 'opinary.xandr.macros',
                macros: {},
                size: { width: 320, height: 320 },
            },
            '*'
        );
    });

    update_iframe_url();

    window.addEventListener("message", (event) => {
        if (!event.origin.match(/(pressekompass\.net|opinary\.com)$/) || event.data?.type !== "opinary.vote") {
            return;
        }
        alert("received vote, call mCanvas impactor");
        console.log("vote data", event.data);
    });
}
</script>